<VirtualHost *:80>
    # The ServerName directive sets the request scheme, hostname and port that
    # the server uses to identify itself. This is used when creating
    # redirection URLs. In the context of virtual hosts, the ServerName
    # specifies what hostname must appear in the request's Host: header to
    # match this virtual host. For the default virtual host (this file) this
    # value is not decisive as it is used as a last resort host regardless.
    # However, you must set it for any further virtual host explicitly.
    ServerName dev.asmbtennis.fr

    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    # Sur environnement de DEV en Apache 2.4 (contrairement à prod en 2.2), on désactive les .htaccess
    # Toute la config Apache doit donc se trouver hors .htaccess !
    <Directory /var/www/html/public>
        AllowOverride None

        # Make sure MultiViews is disabled if available.
        <IfModule mod_negotiation.c>
            Options -MultiViews
        </IfModule>

        # Désactivation des ETAG, cf. https://lehollandaisvolant.net/tuto/pagespd/
        Header unset ETag
        FileETag none

        # Cf. https://lehollandaisvolant.net/tuto/pagespd/
        # Prends en compte les polices (formats récents)
        AddType application/x-font-woff .woff
        AddType application/x-font-woff2 .woff2
        # active la mise en cache
        ExpiresActive On
        ExpiresDefault "access"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType video/mp4 "access plus 1 year"
        ExpiresByType video/mov "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
        ExpiresByType application/x-font-woff "access plus 1 year"
        ExpiresByType application/x-font-woff2 "access plus 1 year"
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"

        # See https://www.creapulse.fr/guide-seo-optimiser-performances-serveur/
        <IfModule mod_deflate.c>
            AddOutputFilterByType DEFLATE application/font-woff text/html text/plain text/xml application/xml application/xhtml+xml text/css text/javascript application/javascript application/x-javascript
        </IfModule>

        <IfModule mod_rewrite.c>
            RewriteEngine on

            # Utilisation forcée d'HTTPS
            #RewriteCond %{SERVER_PORT} 80
            #RewriteRule ^(.*)$ https://%{SERVER_NAME}/$1 [R,L]

            RewriteRule cache/ - [F]

            # Some servers require the RewriteBase to be set. If so, set to the correct folder.
            # RewriteBase /

            RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
            RewriteRule ^(.*) - [E=BASE:%1]

            # Sets the HTTP_AUTHORIZATION header removed by Apache
            RewriteCond %{HTTP:Authorization} .
            RewriteRule ^ - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

            # Redirect to URI without front controller to prevent duplicate content
            # (with and without `/index.php`). Only do this redirect on the initial
            # rewrite by Apache and not on subsequent cycles. Otherwise we would get an
            # endless redirect loop (request -> rewrite to front controller ->
            # redirect -> request -> ...).
            # So in case you get a "too many redirects" error or you always get redirected
            # to the start page because your Apache does not expose the REDIRECT_STATUS
            # environment variable, you have 2 choices:
            # - disable this feature by commenting the following 2 lines or
            # - use Apache >= 2.3.9 and replace all L flags by END flags and remove the
            #   following RewriteCond (best solution)
            RewriteCond %{ENV:REDIRECT_STATUS} ^$
            RewriteRule ^index\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]

            # If the requested filename exists, simply serve it.
            # We only want to let Apache serve files and not directories.
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteCond %{REQUEST_URI} !=/favicon.ico
            RewriteCond %{REQUEST_FILENAME} -f
            RewriteRule ^ - [L]

            # Rewrite all other queries to the front controller.
            RewriteRule ^ %{ENV:BASE}/index.php [L]
        </IfModule>

        # Block access to all hidden files and directories. These types of files
        # usually contain user preferences and can include private information like,
        # for example, the `.git` or `.svn` directories.
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteCond %{REQUEST_URI} "!(^|/)\.well-known/([^./]+./?)+$" [NC]
            RewriteCond %{SCRIPT_FILENAME} -d [OR]
            RewriteCond %{SCRIPT_FILENAME} -f
            RewriteRule "(^|/)\." - [F]
        </IfModule>
    </Directory>

    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
    # error, crit, alert, emerg.
    # It is also possible to configure the loglevel for particular
    # modules, e.g.
    #LogLevel info ssl:warn

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # For most configuration files from conf-available/, which are
    # enabled or disabled at a global level, it is possible to
    # include a line for only one particular virtual host. For example the
    # following line enables the CGI configuration for this host only
    # after it has been globally disabled with "a2disconf".
    #Include conf-available/serve-cgi-bin.conf
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
