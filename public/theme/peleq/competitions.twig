{% extends 'partials/_master.twig' %}

{% block main %}
    {% set poolsPerCategoryName = getPoolsPerCategoryName(record.competition_id, record.competition_categories) %}
    {% set poolRankingPerPoolId = getPoolRankingPerPoolId(record.competition_id, record.competition_categories) %}
    {% set poolMeetingsPerPoolId = getPoolMeetingsPerPoolId(record.competition_id, record.competition_categories) %}

    {% set MAX_PER_ROW = 4 %}

    <section class="section section-competition">
        <div class="container">
            <h1 class="title is-size-1 is-size-3-mobile">{{ record.title }}</h1>

            <div class="columns">
                {% set idx = 0 %}
                {% for categoryName, pools in poolsPerCategoryName %}
                    {% if pools is not empty %}
                        {% for pool in pools %}

                            {% if loop.first and (pools|length + (idx % MAX_PER_ROW)) > MAX_PER_ROW %}
                                {% set nbEmptyBlock = (pools|length + (idx % MAX_PER_ROW)) - MAX_PER_ROW %}
                                {% for i in 0..nbEmptyBlock %}
                                    {% if (idx % MAX_PER_ROW) != 0 %}
                                        <div class="column is-{{ MAX_PER_ROW-1 }} is-invisible-desktop is-hidden-touch"></div>
                                        {% set idx = idx+1 %}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                            <div class="column is-{{ MAX_PER_ROW-1 }}">
                                {# TODO retirer, pour debug #}
                                {#idx={{ idx }} ; idx % MAX_PER_ROW={{ (idx % MAX_PER_ROW) }} ; pools|length + idx={{ pools|length + idx }}#}
                                {% if loop.first or prevCategoryName != categoryName %}
                                    <h2 class="title">{{ categoryName }}</h2>
                                    {% set prevCategoryName = categoryName %}
                                {% else %}
                                    <h2 class="title is-invisible">{{ categoryName }}</h2>
                                {% endif %}

                                {{ include('partials/competition/_pool.twig', {
                                    'poolRanking': poolRankingPerPoolId[pool.id],
                                    'meetingsPerDay': poolMeetingsPerPoolId[pool.id],
                                }) }}
                            </div>
                            {% set idx = idx+1 %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </section>

{% endblock main %}
