{% extends 'partials/_master.twig' %}

{% block main %}
    {% set poolsPerCategoryName = getPoolsPerCategoryName(record.competition_id, record.competition_categories) %}
    {% set poolRankingPerPoolId = getPoolRankingPerPoolId(record.competition_id, record.competition_categories) %}
    {% set poolMeetingsPerPoolId = getPoolMeetingsPerPoolId(record.competition_id, record.competition_categories) %}

    {% set MAX_PER_ROW = 4 %}

    <section class="section section-competition">
        <div class="container">
            <h1 class="title is-size-1 is-size-3-mobile">{{ record.title }}</h1>

            <div class="columns">
                {% set idx = 0 %}
                {% for categoryName, pools in poolsPerCategoryName %}
                    {% if pools is not empty %}
                        {% for pool in pools %}

                            {% set forceNewLine = false %}
                            {% if loop.first and (pools|length + idx) > MAX_PER_ROW %}
                                {% set forceNewLine = true %}
                                <div class="column is-{{ MAX_PER_ROW-1 }} is-invisible-desktop is-hidden-touch"></div>
                            {% endif %}

                            <div class="column is-{{ MAX_PER_ROW-1 }}{{ forceNewLine ? ' is-new-line' }}">
                                {% if loop.first or prevCategoryName != categoryName %}
                                    <h2 class="title">{{ categoryName }}</h2>
                                    {% set prevCategoryName = categoryName %}
                                {% else %}
                                    <h2 class="title is-invisible">{{ categoryName }}</h2>
                                {% endif %}

                                {{ include('partials/competition/_pool.twig', {
                                    'poolRanking': poolRankingPerPoolId[pool.id],
                                    'meetingsPerDay': poolMeetingsPerPoolId[pool.id],
                                }) }}
                            </div>
                            {% set idx = idx+1 %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </section>

{% endblock main %}
